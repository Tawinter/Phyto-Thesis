library(ggplot2)
library(dplyr)
library(tidyr)
library(forcats)
library(tidyverse)
library(ggtext)
library(ggpubr)
library(formattable)
library(scales)
library(lubridate)
library(nlme)
library(lemon)
library(DescTools)
library(viridis)
library(mblm)
#Data frame corrections and manipulations
nutlong <- read.csv("CML_Nut_Long.csv" , stringsAsFactors = TRUE)
setwd("C:/phyto-thesis")
#Data frame corrections and manipulations
nutlong <- read.csv("CML_Nut_Long.csv" , stringsAsFactors = TRUE)
View(nutlong)
#Graphing against nitrogen
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = nitrogen, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_x_continuous(limits = c(0, 0.16), breaks = seq(0, 0.16, 0.02)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Nitrogen ' ~(mg~L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
#Graphing against nitrogen
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = nitrogen, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Nitrogen ' ~(mg~L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
#Graphing against nitrogen
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = nitrogen, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_x_continuous(limits = c(0, 0.16), breaks = seq(0, 0.16, 0.02)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Nitrogen ' ~(mg~L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
##Poster Graph Nitrogen:Phosphorus
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = N.P, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab('Nitrogen:Phosphorus')+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
##Poster Graph Nitrogen:Phosphorus
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = N.P, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_x_continuous(limits = c(0, 8), breaks = seq(0,8,1)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab('Nitrogen:Phosphorus')+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
#Graphing against tss
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = tss, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_x_continuous(limits = c(10, 24), breaks = seq(10,24,2)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Total suspended solids ' ~(mg~L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
#Graphing against tss
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = tss, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Total suspended solids ' ~(mg~L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
#Graphing against tss
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = tss, y = abundance.avg)) +
geom_point(size = 2.5, shape = 21, aes(fill = Year)) +
scale_x_continuous(limits = c(10, 24), breaks = seq(10,24,2)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Total suspended solids ' ~(mg~L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
#Graphing against chla
blab <- expression('Chlorophyll a (' *mu*g/l*')')
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = chla, y = abundance.avg)) +
geom_point(size = 2.5, shape =21, aes(fill = Year)) +
scale_x_continuous(limits = c(0,20), breaks = seq(0,20,2)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Chlorophyll ' ~(mu*L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = chla, y = abundance.avg)) +
geom_point(size = 2.5, shape =21, aes(fill = Year)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Chlorophyll ' ~(mu*L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
scale_x_continuous(limits = c(0,20), breaks = seq(0,20,2)) +
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = chla, y = abundance.avg)) +
geom_point(size = 2.5, shape =21, aes(fill = Year)) +
scale_x_continuous(limits = c(0,20), breaks = seq(0,20,2)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Chlorophyll ' ~(mu*L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
ggplot(nutlong[which(nutlong$abundance.avg>0),], aes(x = chla, y = abundance.avg)) +
geom_point(size = 2.5, shape =21, aes(fill = Year)) +
scale_x_continuous(limits = c(0,20), breaks = seq(0,20,2)) +
scale_y_log10(labels = function(x) format(x, scientific = TRUE)) +
scale_fill_viridis() +
theme_bw() +
xlab(bquote('Chlorophyll ' ~(mu*L^-1)))+
ylab(bquote('Log average abundance ' ~(cells~L^-1))) +
facet_grid(rows = vars(species.avg))
#Testing variables for normality for PLS analysis
hist(nutlong$phosphorus)
hist(nutlong$tss)
hist(nutlong$chla)
hist(nutlong$nitrogen)
hist(nutlong$salinity)
hist(nutlong$temperature)
hist(nutlong$N.P)
hist(nutlong$abundance.avg)
#Performing the PLs
install.packages("pls")
library(pls)
set.seed(1)
pcml <- plsr(abundance.avg~temperature+salinity+nitrogen+phosphorus+N.P+tss+chla,
data=nutlong, scale=TRUE, validation="CV")
View(pcml)
summary(pcml)
#visualizing results
validationplot(pcml)
validationplot(pcml, val.type="MSEP")
validationplot(pcml, val.type="R2")
#visualizing results
validationplot(pcml)
validationplot(pcml, val.type="MSEP")
validationplot(pcml, val.type="R2")
#Taking the log of data to fix skews
nutlong <- read.csv("CML_Nut_Long.csv" , stringsAsFactors = TRUE)
#Taking the log of data to fix skews
nuts <- read.csv("CML_Nut_Long.csv" , stringsAsFactors = TRUE)
nutslog <- log1p(nuts)
View(nuts)
alexnut <- nuts[ which(nuts$species.avg=='Alex', ]
alexnut <- nuts[ which(nuts$species.avg=='Alex',) ]
alexnut <- subset(nuts, species.avg == 'Alex',
select=c(phosphorus, tss, chla, nitrogen, salinity, temperature,
N.P, abundance.avg))
View(alexnut)
alexnut <- alexut[-c(58,59), ]
alexnut <- alexnut[-c(58,59), ]
#Small_PN
smallnut <- subset(nuts, species.avg == 'Small_PN',
select=c(phosphorus, tss, chla, nitrogen, salinity, temperature,
N.P, abundance.avg))
View(smallnut)
smallnut <- smallnut[-c(176,177), ] #removed since NA for abundance data
smallnut <- smallnut[-c(176,177), ]
smallnut <- smallnut[-c(176,177), ]
smallnut <- smallnut[-c(176,177),]
smallnut <- smallnut[-c(58,59),]
#Large_PN
largenut <- subset(nuts, species.avg == 'Large_PN',
select=c(phosphorus, tss, chla, nitrogen, salinity, temperature,
N.P, abundance.avg))
View(largenut)
largenut <- largenut[-c(58,59),]
#Taking the log of data to fix skews
alexlog <- log1p(alexnut)
View(alexlog)
hist(alexlog$phosphorus)
hist(alexlog$tss)
hist(alexlog$chla)
hist(alexlog$nitrogen)
hist(alexlog$salinity)
hist(alexlog$temperature)
hist(alexlog$N.P)
hist(alexlog$abundance.avg)
#Taking the log of data and checking skews for small PN
smalllog <- log1p(smallnut)
hist(smalllog$phosphorus)
hist(smalllog$tss)
hist(smalllog$chla)
hist(smalllog$nitrogen)
hist(smalllog$salinity)
hist(smalllog$temperature)
hist(smalllog$N.P)
hist(smalllog$abundance.avg)
#Taking the log of the data and checking skews for large PN
largelog <- log1p(largenut)
hist(largelog$phosphorus)
hist(largelog$tss)
hist(largelog$chla)
hist(largelog$nitrogen)
hist(largelog$salinity)
hist(largelog$temperature)
hist(largelog$N.P)
hist(largelog$abundance.avg)
#Performing the PLs
set.seed(1)
plsalex <- plsr(abundance.avg~temperature+salinity+nitrogen+phosphorus+N.P+tss+chla,
data=alexlog, scale=TRUE, validation="CV")
summary(plsalex)
?plsr
#Performing the PLs
set.seed(10)
plsalex <- plsr(abundance.avg~temperature+salinity+nitrogen+phosphorus+N.P+tss+chla,
na.action = na.omit, data=alexlog, scale=TRUE, validation="LOOCV")
plsalex <- plsr(abundance.avg~temperature+salinity+nitrogen+phosphorus+N.P+tss+chla,
na.action = na.omit, data=alexlog, scale=TRUE, validation="LOO")
summary(plsalex)
validationplot(plsalex)
validationplot(plsalex, val.type="MSEP")
validationplot(plsalex, val.type="R2")
plsSmall <- plsr(abundance.avg~temperature+salinity+nitrogen+phosphorus+N.P+tss+chla,
na.action = na.omit, data=smalllog, scale=TRUE, validation="LOO")
summary(plsSmall)
validationplot(plsSmall)
validationplot(plsSmall, val.type="MSEP")
validationplot(plsSmall, val.type="R2")
plslarge <- plsr(abundance.avg~temperature+salinity+nitrogen+phosphorus+N.P+tss+chla,
na.action = na.omit, data=largelog, scale=TRUE, validation="LOO")
summary(plslarge)
validationplot(plslarge)
validationplot(plslarge, val.type="MSEP")
validationplot(plslarge, val.type="R2")
#Non-parametric test
install.packages("plsRglm")
library(plsRglm)
?plsRglm
xalex<-alexlog[,1:7]
yalex<-alexlogl[,8]
yalex<-alexlogl[,8]
yalex<-alexlog[,8]
Xalex<-alexlog[,1:7]
plsRglmmodel.default(yalex, xalex)
plsRglmmodel.default(yalex, xalex, nt = 7)
plsRglmmodel.default(yalex, xalex, nt = 7, modele = 'pls')
plsRglmmodel.default(yalex, xalex, nt = 7, dataPredictY = xalex, modele = 'pls')
plsRglmmodel.default(alexlog, yalex, xalex, nt = 7, dataPredictY = xalex, modele = 'pls', familiy = NULL,
)
plsRglmmodel.default(alexlog, yalex, xalex, nt = 7, dataPredictY = xalex, modele = 'pls')
plsRglmmodel.default(alexlog, yalex, xalex, nt = 7, modele = 'pls')
plsRglmmodel.default(alexlog)
nPlsAlex <- plsRglm(yalex, xalex, 10, modele = 'pls')
summary(nPlsAlex)
View(nPlsAlex)
nPlsAlex <- plsRglm(yalex, xalex, 10, modele = 'pls-glm-gaussian')
nPlsAlex <- plsRglm(yalex, xalex, 10)
